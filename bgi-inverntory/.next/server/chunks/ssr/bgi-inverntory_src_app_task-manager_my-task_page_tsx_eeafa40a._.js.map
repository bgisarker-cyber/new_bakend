{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Bgi-terminal-management/bgi-inverntory/src/app/task-manager/my-task/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useQuery, useMutation, useQueryClient, QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport axios from \"axios\";\r\nimport { useState } from \"react\";\r\n\r\n/* ---------- axios ---------- */\r\naxios.defaults.baseURL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000\";\r\naxios.interceptors.request.use((cfg) => {\r\n  const t = localStorage.getItem(\"access_token\");\r\n  if (t) cfg.headers.Authorization = `Bearer ${t}`;\r\n  return cfg;\r\n});\r\n\r\n/* ---------- types ---------- */\r\ntype Task = {\r\n  id: number;\r\n  title: string;\r\n  merchant_name: string;\r\n  merchant_phone: string;\r\n  location: string;\r\n  problem_type: string;\r\n  problem_details: string;\r\n  instructions: string;\r\n  priority: \"low\" | \"medium\" | \"high\";\r\n  status: \"open\" | \"in_progress\" | \"completed\";\r\n  create_time: string;\r\n};\r\n\r\n/* ---------- react-query ---------- */\r\nconst queryClient = new QueryClient();\r\n\r\n/* ---------- main component ---------- */\r\nfunction MyTasksGrid() {\r\n  const [open, setOpen] = useState(false);\r\n  const [selected, setSelected] = useState<Task | null>(null);\r\n  const [status, setStatus] = useState<\"open\" | \"in_progress\" | \"completed\">(\"open\");\r\n  const [note, setNote] = useState(\"\");\r\n\r\n  const { data = [], isLoading, refetch } = useQuery<Task[]>({\r\n    queryKey: [\"my-tasks\"],\r\n    queryFn: () => axios.get(\"/tasks/my\").then((r) => r.data),\r\n  });\r\n\r\n  const mutate = useMutation({\r\n    mutationFn: () =>\r\n      axios.put(`/tasks/my/${selected!.id}/status`, {\r\n        status_val: status,\r\n        note,\r\n      }),\r\n    onSuccess: () => {\r\n      setOpen(false);\r\n      queryClient.invalidateQueries({ queryKey: [\"my-tasks\"] });\r\n    },\r\n  });\r\n\r\n  const chipColor = (s: Task[\"status\"]) =>\r\n    s === \"completed\" ? \"bg-green-100 text-green-800\" : s === \"in_progress\" ? \"bg-blue-100 text-blue-800\" : \"bg-gray-100 text-gray-800\";\r\n\r\n  const priorityColor = (p: Task[\"priority\"]) =>\r\n    p === \"high\" ? \"bg-red-100 text-red-800\" : p === \"medium\" ? \"bg-yellow-100 text-yellow-800\" : \"bg-green-100 text-green-800\";\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-6 max-w-7xl\">\r\n      {/* ---------- top bar ---------- */}\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-900\">My Tasks</h1>\r\n        <button\r\n          onClick={() => refetch()}\r\n          className=\"p-2 rounded-full hover:bg-gray-100 transition-colors\"\r\n          title=\"Refresh\"\r\n        >\r\n          {isLoading ? (\r\n            <span className=\"inline-block w-5 h-5 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin\" />\r\n          ) : (\r\n            <span className=\"text-xl\">üîÑ</span>\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* ---------- cards grid ---------- */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n        {data.map((t) => (\r\n          <div\r\n            key={t.id}\r\n            className=\"border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow flex flex-col\"\r\n          >\r\n            <div className=\"p-4 flex-grow\">\r\n              <div className=\"space-y-2\">\r\n                <h3 className=\"font-semibold text-lg text-gray-900 truncate\" title={t.title}>\r\n                  {t.title}\r\n                </h3>\r\n\r\n                <div className=\"flex gap-2\">\r\n                  <span className={`inline-block px-2 py-1 rounded-full text-xs font-medium ${chipColor(t.status)}`}>\r\n                    {t.status.replace(\"_\", \" \")}\r\n                  </span>\r\n                  <span className={`inline-block px-2 py-1 rounded-full text-xs font-medium ${priorityColor(t.priority)}`}>\r\n                    {t.priority}\r\n                  </span>\r\n                </div>\r\n\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Merchant:</strong> {t.merchant_name}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Contact:</strong> {t.merchant_phone}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Location:</strong> {t.location}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Problem:</strong> {t.problem_type}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Details:</strong> {t.problem_details}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  <strong className=\"font-medium\">Instructions:</strong> {t.instructions}\r\n                </p>\r\n\r\n                <p className=\"text-xs text-gray-500 mt-2\">\r\n                  Created: {new Date(t.create_time).toLocaleString()}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-4 pt-0 flex justify-end\">\r\n              <button\r\n                onClick={() => {\r\n                  setSelected(t);\r\n                  setStatus(t.status);\r\n                  setNote(\"\");\r\n                  setOpen(true);\r\n                }}\r\n                className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 transition-colors\"\r\n              >\r\n                ‚úèÔ∏è Update\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* ---------- empty state ---------- */}\r\n      {!isLoading && data.length === 0 && (\r\n        <p className=\"text-center text-gray-500 mt-12 text-lg\">\r\n          No tasks assigned to you üéâ\r\n        </p>\r\n      )}\r\n\r\n      {/* ---------- update dialog ---------- */}\r\n      {open && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-lg w-full max-w-lg\">\r\n            <div className=\"flex justify-between items-center p-4 border-b\">\r\n              <h2 className=\"text-xl font-semibold text-gray-900\">\r\n                Update Task #{selected?.id}\r\n              </h2>\r\n              <button\r\n                onClick={() => setOpen(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 text-2xl leading-none\"\r\n              >\r\n                √ó\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"p-4 space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Status\r\n                </label>\r\n                <select\r\n                  value={status}\r\n                  onChange={(e) => setStatus(e.target.value as any)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                >\r\n                  <option value=\"open\">Open</option>\r\n                  <option value=\"in_progress\">In Progress</option>\r\n                  <option value=\"completed\">Completed</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Note (optional)\r\n                </label>\r\n                <textarea\r\n                  value={note}\r\n                  onChange={(e) => setNote(e.target.value)}\r\n                  rows={3}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-2 p-4 border-t\">\r\n              <button\r\n                onClick={() => setOpen(false)}\r\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={() => mutate.mutate()}\r\n                disabled={mutate.isPending}\r\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors inline-flex items-center gap-2\"\r\n              >\r\n                {mutate.isPending ? (\r\n                  <>\r\n                    <span className=\"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                    Saving...\r\n                  </>\r\n                ) : (\r\n                  \"Save\"\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function MyTasksPage() {\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <MyTasksGrid />\r\n    </QueryClientProvider>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}