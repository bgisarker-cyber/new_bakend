{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///D:/Bgi-terminal-management/bgi-inverntory/src/app/task-manager/create-task/page.tsx"],"sourcesContent":["// src/app/task-manager/page.tsx\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useForm, Controller } from \"react-hook-form\";\r\nimport { useQuery, QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport axios from \"axios\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  CardContent,\r\n  CircularProgress,\r\n  MenuItem,\r\n  Stack,\r\n  TextField,\r\n  Typography,\r\n  Alert,\r\n  Autocomplete,\r\n} from \"@mui/material\";\r\nimport { Visibility as ViewIcon, Assignment as AssignIcon } from \"@mui/icons-material\";\r\n\r\n/* ---------- config ---------- */\r\naxios.defaults.baseURL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000\";\r\naxios.interceptors.request.use((cfg) => {\r\n  const t = localStorage.getItem(\"access_token\");\r\n  if (t) cfg.headers.Authorization = `Bearer ${t}`;\r\n  return cfg;\r\n});\r\n\r\n/* ---------- types ---------- */\r\ntype User = { id: number; username: string; role: string };\r\ntype FormInputs = {\r\n  title: string;\r\n  merchant_name: string;\r\n  merchant_phone: string;\r\n  bank: string;\r\n  location: string;\r\n  problem_type: string;\r\n  problem_details: string;\r\n  instructions: string;\r\n  task_type: \"install\" | \"repair\" | \"maintenance\";\r\n  assigned_to: number | null;\r\n  priority: \"low\" | \"medium\" | \"high\";\r\n};\r\n\r\nconst PROBLEM_CHOICES = [\r\n  \"Battery down\",\r\n  \"Payment not working\",\r\n  \"Network off\",\r\n  \"Display not responsive\",\r\n  \"App change required\",\r\n  \"Firmware change\",\r\n  \"Other\",\r\n];\r\n\r\n/* ---------- query ---------- */\r\nconst queryClient = new QueryClient();\r\nfunction useAssignableUsers() {\r\n  return useQuery({\r\n    queryKey: [\"assignable-users\"],\r\n    queryFn: async () => (await axios.get<User[]>(\"/auth/userlist?role=support,admin\")).data,\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/* ---------- form ---------- */\r\nfunction CreateCallForm() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [msg, setMsg] = useState<{ type: \"success\" | \"error\"; text: string } | null>(null);\r\n\r\n  const { register, handleSubmit, control, reset, formState: { errors } } = useForm<FormInputs>({\r\n    defaultValues: { priority: \"medium\", task_type: \"repair\", problem_type: \"Other\" },\r\n  });\r\n\r\n  const { data: users = [], isLoading: loadingUsers } = useAssignableUsers();\r\n\r\n  const onSubmit = async (data: FormInputs) => {\r\n    if (!data.assigned_to) return setMsg({ type: \"error\", text: \"Pick an assignee\" });\r\n    setLoading(true); setMsg(null);\r\n    try {\r\n      await axios.post(\"/tasks/create\", { ...data, assigned_to: data.assigned_to, assigned_by: Number(localStorage.getItem(\"userId\") || 1) });\r\n      setMsg({ type: \"success\", text: \"Call assigned\" }); reset();\r\n    } catch (e: any) {\r\n      setMsg({ type: \"error\", text: e.response?.data?.detail || \"Network error\" });\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ maxWidth: 800, mx: \"auto\", py: 3 }}>\r\n      {/* top bar */}\r\n      <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\" mb={2}>\r\n        <Typography variant=\"h5\" fontWeight={600}>Assign A Call</Typography>\r\n        <Button\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          startIcon={<ViewIcon />}\r\n          onClick={() => router.push(\"/task-manager/task-call\")}\r\n        >\r\n          View Calls\r\n        </Button>\r\n      </Stack>\r\n\r\n      {msg && <Alert severity={msg.type} sx={{ mb: 2 }}>{msg.text}</Alert>}\r\n\r\n      {/* compact form */}\r\n      <Card>\r\n        <CardContent>\r\n          <form onSubmit={handleSubmit(onSubmit)}>\r\n            <Stack spacing={1}>\r\n              <TextField size=\"small\" label=\"Title\" {...register(\"title\", { required: \"Required\" })} error={!!errors.title} helperText={errors.title?.message} />\r\n              <TextField size=\"small\" label=\"Merchant Name\" {...register(\"merchant_name\", { required: \"Required\" })} error={!!errors.merchant_name} helperText={errors.merchant_name?.message} />\r\n              <TextField size=\"small\" label=\"Merchant Phone\" {...register(\"merchant_phone\", { required: \"Required\" })} error={!!errors.merchant_phone} helperText={errors.merchant_phone?.message} />\r\n               <TextField size=\"small\" select label=\"Bank\" {...register(\"bank\")}>\r\n                <MenuItem value=\"CityBank\">CityBank</MenuItem>\r\n                <MenuItem value=\"PubaliBank\">PubaliBank</MenuItem>\r\n                <MenuItem value=\"IslamiBank\">IslamiBank</MenuItem>\r\n                <MenuItem value=\"Mutual Trust Bank\">Mutual Trust Bank</MenuItem>\r\n\r\n                <MenuItem value=\"Standard Bank\">Standard Bank</MenuItem>\r\n\r\n              </TextField>\r\n              <TextField size=\"small\" label=\"Location\" {...register(\"location\", { required: \"Required\" })} error={!!errors.location} helperText={errors.location?.message} />\r\n\r\n              <TextField size=\"small\" select label=\"Problem Type\" {...register(\"problem_type\")}>\r\n                {PROBLEM_CHOICES.map((p) => <MenuItem key={p} value={p}>{p}</MenuItem>)}\r\n              </TextField>\r\n              <TextField size=\"small\" label=\"Problem Details\" multiline rows={2} {...register(\"problem_details\")} />\r\n              <TextField size=\"small\" label=\"Instructions\" multiline rows={2} {...register(\"instructions\")} />\r\n\r\n              <TextField size=\"small\" select label=\"Task Type\" {...register(\"task_type\")}>\r\n                <MenuItem value=\"install\">Install</MenuItem>\r\n                <MenuItem value=\"repair\">Repair</MenuItem>\r\n                <MenuItem value=\"maintenance\">Maintenance</MenuItem>\r\n              </TextField>\r\n\r\n              <TextField size=\"small\" select label=\"Priority\" {...register(\"priority\")}>\r\n                <MenuItem value=\"low\">Low</MenuItem>\r\n                <MenuItem value=\"medium\">Medium</MenuItem>\r\n                <MenuItem value=\"high\">High</MenuItem>\r\n              </TextField>\r\n\r\n              {/* assignee */}\r\n              <Controller\r\n                name=\"assigned_to\"\r\n                control={control}\r\n                render={({ field }) => (\r\n                  <Autocomplete\r\n                    size=\"small\"\r\n                    options={users}\r\n                    getOptionLabel={(u) => `${u.username} (${u.role})`}\r\n                    isOptionEqualToValue={(opt, val) => opt.id === val.id}\r\n                    value={users.find((u) => u.id === field.value) || null}\r\n                    onChange={(_, newVal) => field.onChange(newVal?.id ?? null)}\r\n                    renderInput={(params) => <TextField {...params} label=\"Assign To\" required error={!!errors.assigned_to} helperText={errors.assigned_to && \"Required\"} />}\r\n                  />\r\n                )}\r\n              />\r\n\r\n              <Button\r\n                type=\"submit\"\r\n                variant=\"contained\"\r\n                size=\"small\"\r\n                disabled={loading}\r\n                startIcon={<AssignIcon />}\r\n                sx={{ borderRadius: 3 }}\r\n              >\r\n                Assign Call\r\n              </Button>\r\n            </Stack>\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default function TaskManagerPage() {\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <CreateCallForm />\r\n    </QueryClientProvider>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}