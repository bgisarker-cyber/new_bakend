{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code%20app/Bgi-terminal-management/bgi-inverntory/src/app/user-log/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport default function UserLogsPage() {\r\n  const [logs, setLogs] = useState<any[]>([]);\r\n  const [filteredLogs, setFilteredLogs] = useState<any[]>([]);\r\n  const [error, setError] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Filters\r\n  const [emailFilter, setEmailFilter] = useState(\"\");\r\n  const [actionFilter, setActionFilter] = useState(\"\");\r\n  const [dateFilter, setDateFilter] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState(\"\");\r\n\r\n  // Pagination\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const itemsPerPage = 20;\r\n\r\n  useEffect(() => {\r\n    const fetchLogs = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"access_token\");\r\n        const res = await fetch(\"http://127.0.0.1:8000/logs/show\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const data = await res.json();\r\n        if (!res.ok) throw new Error(data.detail || \"Failed to fetch logs\");\r\n        setLogs(data.data);\r\n        setFilteredLogs(data.data);\r\n      } catch (err: any) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchLogs();\r\n  }, []);\r\n\r\n  // Apply filters dynamically\r\n  useEffect(() => {\r\n    let filtered = logs;\r\n\r\n    if (emailFilter)\r\n      filtered = filtered.filter((log) =>\r\n        log.user_email?.toLowerCase().includes(emailFilter.toLowerCase())\r\n      );\r\n\r\n    if (actionFilter)\r\n      filtered = filtered.filter((log) =>\r\n        log.action?.toLowerCase().includes(actionFilter.toLowerCase())\r\n      );\r\n\r\n    if (roleFilter)\r\n      filtered = filtered.filter((log) =>\r\n        log.user_role?.toLowerCase().includes(roleFilter.toLowerCase())\r\n      );\r\n\r\n    if (dateFilter)\r\n      filtered = filtered.filter(\r\n        (log) =>\r\n          new Date(log.timestamp).toLocaleDateString() ===\r\n          new Date(dateFilter).toLocaleDateString()\r\n      );\r\n\r\n    setFilteredLogs(filtered);\r\n    setCurrentPage(1); // Reset to first page on filter change\r\n  }, [emailFilter, actionFilter, roleFilter, dateFilter, logs]);\r\n\r\n  // Pagination calculations\r\n  const totalPages = Math.ceil(filteredLogs.length / itemsPerPage);\r\n  const paginatedLogs = filteredLogs.slice(\r\n    (currentPage - 1) * itemsPerPage,\r\n    currentPage * itemsPerPage\r\n  );\r\n\r\n  if (loading)\r\n    return (\r\n      <p className=\"p-6 text-gray-600 text-center text-lg font-medium\">\r\n        Loading logs...\r\n      </p>\r\n    );\r\n  if (error)\r\n    return (\r\n      <p className=\"p-6 text-red-500 text-center text-lg font-medium\">{error}</p>\r\n    );\r\n\r\n  return (\r\n    <div className=\"p-6 min-h-screen bg-gray-50\">\r\n      <h1 className=\"text-3xl font-bold mb-6 text-center text-gray-800\">\r\n        User Activity Logs\r\n      </h1>\r\n\r\n      {/* Filters - Sticky */}\r\n      <div className=\"sticky top-0 bg-gray-50 z-20 py-4 max-w-5xl mx-auto\">\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Filter by Email\"\r\n            value={emailFilter}\r\n            onChange={(e) => setEmailFilter(e.target.value)}\r\n            className=\"border border-gray-300 rounded-xl p-2 w-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition\"\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Filter by Action\"\r\n            value={actionFilter}\r\n            onChange={(e) => setActionFilter(e.target.value)}\r\n            className=\"border border-gray-300 rounded-xl p-2 w-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition\"\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Filter by Role\"\r\n            value={roleFilter}\r\n            onChange={(e) => setRoleFilter(e.target.value)}\r\n            className=\"border border-gray-300 rounded-xl p-2 w-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition\"\r\n          />\r\n          <input\r\n            type=\"date\"\r\n            value={dateFilter}\r\n            onChange={(e) => setDateFilter(e.target.value)}\r\n            className=\"border border-gray-300 rounded-xl p-2 w-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"overflow-x-auto rounded-2xl shadow-lg bg-white max-w-5xl mx-auto\">\r\n        <table className=\"min-w-full border-collapse table-auto text-sm\">\r\n          <thead className=\"bg-blue-50 sticky top-0 z-10\">\r\n            <tr>\r\n              <th className=\"border-b p-2 text-left text-gray-700 w-1/4\">User Email</th>\r\n              <th className=\"border-b p-2 text-left text-gray-700 w-1/6\">Role</th>\r\n              <th className=\"border-b p-2 text-left text-gray-700 w-1/6\">Action</th>\r\n              <th className=\"border-b p-2 text-left text-gray-700 w-1/3\">Description</th>\r\n              <th className=\"border-b p-2 text-left text-gray-700 w-1/6\">Timestamp</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {paginatedLogs.length > 0 ? (\r\n              paginatedLogs.map((log, idx) => (\r\n                <tr\r\n                  key={log.id}\r\n                  className={`border-b transition-colors ${\r\n                    idx % 2 === 0 ? \"bg-white\" : \"bg-gray-50\"\r\n                  } hover:bg-gray-100`}\r\n                >\r\n                  <td className=\"p-2 truncate\" title={log.user_email}>{log.user_email}</td>\r\n                  <td className=\"p-2 truncate\" title={log.user_role}>{log.user_role}</td>\r\n                  <td className=\"p-2 font-semibold text-blue-600 truncate\" title={log.action}>{log.action}</td>\r\n                  <td className=\"p-2 truncate\" title={log.description || \"-\"}>{log.description || \"-\"}</td>\r\n                  <td className=\"p-2 truncate\" title={new Date(log.timestamp).toLocaleString()}>\r\n                    {new Date(log.timestamp).toLocaleString()}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            ) : (\r\n              <tr>\r\n                <td colSpan={5} className=\"text-center text-gray-500 p-4 italic\">\r\n                  No logs found matching your filters.\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      {totalPages > 1 && (\r\n        <div className=\"flex justify-center items-center gap-2 mt-4\">\r\n          <button\r\n            onClick={() => setCurrentPage((prev) => Math.max(prev - 1, 1))}\r\n            disabled={currentPage === 1}\r\n            className=\"px-3 py-1 rounded bg-blue-500 text-white disabled:bg-gray-300 hover:bg-blue-600 transition text-sm\"\r\n          >\r\n            Prev\r\n          </button>\r\n          <span className=\"px-2 py-1 text-sm\">\r\n            Page {currentPage} of {totalPages}\r\n          </span>\r\n          <button\r\n            onClick={() => setCurrentPage((prev) => Math.min(prev + 1, totalPages))}\r\n            disabled={currentPage === totalPages}\r\n            className=\"px-3 py-1 rounded bg-blue-500 text-white disabled:bg-gray-300 hover:bg-blue-600 transition text-sm\"\r\n          >\r\n            Next\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}