{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/Bgi-terminal-management/bgi-inverntory/src/app/user-show/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport DataTable, { TableColumn } from \"react-data-table-component\";\r\n\r\n// ==========================\r\n// TypeScript Type\r\n// ==========================\r\ntype User = {\r\n  id: number;\r\n  username: string;\r\n  email: string;\r\n  role: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n};\r\n\r\n// ==========================\r\n// Component\r\n// ==========================\r\nconst UsersPage = () => {\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [filteredUsers, setFilteredUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  // Filters\r\n  const [usernameFilter, setUsernameFilter] = useState(\"\");\r\n  const [emailFilter, setEmailFilter] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState(\"\");\r\n\r\n  // Delete Modal\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n\r\n  const API_BASE = \"http://127.0.0.1:8000/auth\"; // üîß Adjust backend base URL if needed\r\n\r\n  // ==========================\r\n  // Auth Headers\r\n  // ==========================\r\n  const getAuthHeaders = () => {\r\n    const token = localStorage.getItem(\"access_token\");\r\n    return {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  };\r\n\r\n  // ==========================\r\n  // Fetch Users\r\n  // ==========================\r\n  useEffect(() => {\r\n    const fetchUsers = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"access_token\");\r\n        if (!token) throw new Error(\"Please log in first.\");\r\n\r\n        const res = await fetch(`${API_BASE}/all`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        if (!res.ok) throw new Error(\"Failed to load users\");\r\n\r\n        const data = await res.json();\r\n        setUsers(data.data);\r\n        setFilteredUsers(data.data);\r\n      } catch (err: any) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  // ==========================\r\n  // Filter Logic\r\n  // ==========================\r\n  useEffect(() => {\r\n    const filtered = users.filter((user) => {\r\n      const matchUsername = user.username\r\n        .toLowerCase()\r\n        .includes(usernameFilter.toLowerCase());\r\n      const matchEmail = user.email\r\n        .toLowerCase()\r\n        .includes(emailFilter.toLowerCase());\r\n      const matchRole = user.role\r\n        .toLowerCase()\r\n        .includes(roleFilter.toLowerCase());\r\n      return matchUsername && matchEmail && matchRole;\r\n    });\r\n    setFilteredUsers(filtered);\r\n  }, [usernameFilter, emailFilter, roleFilter, users]);\r\n\r\n  // ==========================\r\n  // Delete User\r\n  // ==========================\r\n  const handleDeleteUser = async () => {\r\n    if (!selectedUser) return;\r\n    try {\r\n      const token = localStorage.getItem(\"access_token\");\r\n      const email = localStorage.getItem(\"email\") || \"unknown\";\r\n      const role = localStorage.getItem(\"role\") || \"user\";\r\n\r\n      const res = await fetch(`${API_BASE}/delete/${selectedUser.id}`, {\r\n        method: \"DELETE\",\r\n        headers: getAuthHeaders(),\r\n        body: JSON.stringify({\r\n          log_user_email: email,\r\n          log_user_role: role,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json();\r\n        throw new Error(err.detail || \"Failed to delete user\");\r\n      }\r\n\r\n      alert(\"‚úÖ User deleted!\");\r\n      setShowDeleteModal(false);\r\n      setUsers((prev) => prev.filter((u) => u.id !== selectedUser.id));\r\n      setFilteredUsers((prev) => prev.filter((u) => u.id !== selectedUser.id));\r\n    } catch (err: any) {\r\n      alert(\"‚ùå \" + err.message);\r\n    }\r\n  };\r\n\r\n  // ==========================\r\n  // Table Columns\r\n  // ==========================\r\n  const columns: TableColumn<User>[] = [\r\n    { name: \"SL\", selector: (_r, i) => i + 1, width: \"60px\" },\r\n    { name: \"Username\", selector: (row) => row.username },\r\n    { name: \"Email\", selector: (row) => row.email },\r\n    { name: \"Role\", selector: (row) => row.role },\r\n    {\r\n      name: \"Actions\",\r\n      cell: (row) => (\r\n        <button\r\n          onClick={() => {\r\n            setSelectedUser(row);\r\n            setShowDeleteModal(true);\r\n          }}\r\n          className=\"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\"\r\n        >\r\n          Delete\r\n        </button>\r\n      ),\r\n      width: \"120px\",\r\n    },\r\n  ];\r\n\r\n  // ==========================\r\n  // Render UI\r\n  // ==========================\r\n  if (loading) return <p>Loading...</p>;\r\n  if (error) return <p className=\"text-red-500\">{error}</p>;\r\n\r\n  return (\r\n    <div className=\"p-6 relative\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">User Management</h1>\r\n\r\n      {/* Filters */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Username\"\r\n          value={usernameFilter}\r\n          onChange={(e) => setUsernameFilter(e.target.value)}\r\n          className=\"border rounded px-3 py-2\"\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Email\"\r\n          value={emailFilter}\r\n          onChange={(e) => setEmailFilter(e.target.value)}\r\n          className=\"border rounded px-3 py-2\"\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Role\"\r\n          value={roleFilter}\r\n          onChange={(e) => setRoleFilter(e.target.value)}\r\n          className=\"border rounded px-3 py-2\"\r\n        />\r\n        <button\r\n          onClick={() => {\r\n            setUsernameFilter(\"\");\r\n            setEmailFilter(\"\");\r\n            setRoleFilter(\"\");\r\n          }}\r\n          className=\"bg-gray-200 px-4 py-2 rounded hover:bg-gray-300\"\r\n        >\r\n          Clear\r\n        </button>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"bg-white rounded shadow-md p-2\">\r\n        <DataTable\r\n          columns={columns}\r\n          data={filteredUsers}\r\n          pagination\r\n          striped\r\n          highlightOnHover\r\n          dense\r\n        />\r\n      </div>\r\n\r\n      {/* DELETE MODAL */}\r\n      {showDeleteModal && selectedUser && (\r\n        <div className=\"absolute top-20 left-1/2 transform -translate-x-1/2 z-50\">\r\n          <div className=\"bg-white p-6 rounded shadow-xl w-full max-w-sm border border-gray-200 text-center\">\r\n            <h2 className=\"text-lg font-semibold mb-3\">Confirm Delete</h2>\r\n            <p className=\"mb-4\">\r\n              Are you sure you want to delete user{\" \"}\r\n              <b>{selectedUser.username}</b>?\r\n            </p>\r\n            <div className=\"flex justify-center gap-4\">\r\n              <button\r\n                onClick={() => setShowDeleteModal(false)}\r\n                className=\"bg-gray-300 px-4 py-2 rounded\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleDeleteUser}\r\n                className=\"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700\"\r\n              >\r\n                Delete\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UsersPage;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}