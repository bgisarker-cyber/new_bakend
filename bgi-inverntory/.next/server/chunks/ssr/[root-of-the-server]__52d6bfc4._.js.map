{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/Code%20app/Bgi-terminal-management/bgi-inverntory/src/app/user-show/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport DataTable, { TableColumn } from \"react-data-table-component\";\r\n\r\n// ==========================\r\n// TypeScript Type\r\n// ==========================\r\ntype User = {\r\n  id: number;\r\n  username: string;\r\n  password: string;\r\n  email: string;\r\n  role: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n};\r\n\r\n// ==========================\r\n// Component\r\n// ==========================\r\nconst UsersPage = () => {\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [filteredUsers, setFilteredUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [counter_users, setCounter_users] = useState(0);\r\n\r\n  // Filters\r\n  const [usernameFilter, setUsernameFilter] = useState(\"\");\r\n  const [emailFilter, setEmailFilter] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState(\"\");\r\n\r\n  // Delete Modal\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n\r\n  const API_BASE = \"http://127.0.0.1:8000/auth\"; // Removed trailing space\r\n\r\n  // ==========================\r\n  // Auth Headers\r\n  // ==========================\r\n  const getAuthHeaders = () => {\r\n    const token = localStorage.getItem(\"access_token\");\r\n    return {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n    };\r\n  };\r\n\r\n  // ==========================\r\n  // Fetch Users\r\n  // ==========================\r\n  useEffect(() => {\r\n    const fetchUsers = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"access_token\");\r\n        if (!token) throw new Error(\"Please log in first.\");\r\n\r\n        const res = await fetch(`${API_BASE}/all`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        if (!res.ok) throw new Error(\"Failed to load users\");\r\n\r\n        const data = await res.json();\r\n        setCounter_users(data.data.length);\r\n        setUsers(data.data);\r\n        setFilteredUsers(data.data);\r\n      } catch (err: any) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  // ==========================\r\n  // Filter Logic\r\n  // ==========================\r\n  useEffect(() => {\r\n    const filtered = users.filter((user) => {\r\n      const matchUsername = user.username\r\n        .toLowerCase()\r\n        .includes(usernameFilter.toLowerCase());\r\n      const matchEmail = user.email\r\n        .toLowerCase()\r\n        .includes(emailFilter.toLowerCase());\r\n      const matchRole = user.role\r\n        .toLowerCase()\r\n        .includes(roleFilter.toLowerCase());\r\n      return matchUsername && matchEmail && matchRole;\r\n    });\r\n    setFilteredUsers(filtered);\r\n  }, [usernameFilter, emailFilter, roleFilter, users]);\r\n\r\n  // ==========================\r\n  // Export Excel\r\n  // ==========================\r\n  const handleExport = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"access_token\");\r\n      const response = await fetch(`${API_BASE}/download`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement(\"a\");\r\n      a.href = url;\r\n      a.download = \"Users_Export.xlsx\";\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (err: any) {\r\n      alert(\"❌ Download failed: \" + err.message);\r\n    }\r\n  };\r\n\r\n  // ==========================\r\n  // Delete User\r\n  // ==========================\r\n  const handleDeleteUser = async () => {\r\n    if (!selectedUser) return;\r\n    try {\r\n      const token = localStorage.getItem(\"access_token\");\r\n      const email = localStorage.getItem(\"email\") || \"unknown\";\r\n      const role = localStorage.getItem(\"role\") || \"user\";\r\n\r\n      const res = await fetch(`${API_BASE}/delete/${selectedUser.id}`, {\r\n        method: \"DELETE\",\r\n        headers: getAuthHeaders(),\r\n        body: JSON.stringify({\r\n          log_user_email: email,\r\n          log_user_role: role,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json();\r\n        throw new Error(err.detail || \"Failed to delete user\");\r\n      }\r\n\r\n      alert(\"✅ User deleted!\");\r\n      setShowDeleteModal(false);\r\n      setCounter_users(prev => prev - 1);\r\n      setUsers((prev) => prev.filter((u) => u.id !== selectedUser.id));\r\n      setFilteredUsers((prev) => prev.filter((u) => u.id !== selectedUser.id));\r\n    } catch (err: any) {\r\n      alert(\"❌ \" + err.message);\r\n    }\r\n  };\r\n\r\n  // ==========================\r\n  // Table Columns\r\n  // ==========================\r\n  const columns: TableColumn<User>[] = [\r\n    { name: \"SL\", selector: (row) => row.id, width: \"60px\" },\r\n    { name: \"Username\", selector: (row) => row.username, style: { minWidth: \"150px\" } },\r\n    { name: \"Email\", selector: (row) => row.email, style: { minWidth: \"200px\" } },\r\n    { name: \"Role\", selector: (row) => row.role, style: { minWidth: \"120px\" } },\r\n    {\r\n      name: \"Actions\",\r\n      cell: (row) => (\r\n        <button\r\n          onClick={() => {\r\n            setSelectedUser(row);\r\n            setShowDeleteModal(true);\r\n          }}\r\n          className=\"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700\"\r\n        >\r\n          Delete\r\n        </button>\r\n      ),\r\n      width: \"120px\",\r\n    },\r\n  ];\r\n\r\n  // ==========================\r\n  // Render UI\r\n  // ==========================\r\n  if (loading) return <p className=\"text-center mt-20\">Loading...</p>;\r\n  if (error) return <p className=\"text-red-500 text-center mt-20\">{error}</p>;\r\n\r\n  return (\r\n    <div className=\"min-h-screen p-6 bg-[#e6e9ef] flex flex-col items-center\">\r\n      {/* Title and Top Bar */}\r\n      <div className=\"flex flex-col items-center mb-6 w-full max-w-7xl\">\r\n        <h1 className=\"text-3xl font-bold mb-2 text-center\">User Management</h1>\r\n        <div className=\"flex justify-between items-center w-full px-4\">\r\n          {/* Left - Export */}\r\n          <div className=\"flex-1\">\r\n            <button\r\n              onClick={handleExport}\r\n              className=\"px-6 py-3 rounded-2xl bg-[#e6e9ef] shadow-[6px_6px_12px_rgba(0,0,0,0.15),-6px_-6px_#ffffff] hover:shadow-[4px_4px_8px_rgba(0,0,0,0.2),-4px_-4px_#ffffff] font-semibold\"\r\n            >\r\n              ⬇️ Export Excel\r\n            </button>\r\n          </div>\r\n          \r\n          {/* Center - Total Users */}\r\n          <div className=\"flex-1 text-center\">\r\n            <h2 className=\"text-xl font-semibold\">Total Users: {counter_users}</h2>\r\n          </div>\r\n          \r\n          {/* Right - Empty for balance */}\r\n          <div className=\"flex-1\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters - Neumorphic styled */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 max-w-7xl w-full px-4\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Username\"\r\n          value={usernameFilter}\r\n          onChange={(e) => setUsernameFilter(e.target.value)}\r\n          className=\"px-3 py-2 rounded-2xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Email\"\r\n          value={emailFilter}\r\n          onChange={(e) => setEmailFilter(e.target.value)}\r\n          className=\"px-3 py-2 rounded-2xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filter by Role\"\r\n          value={roleFilter}\r\n          onChange={(e) => setRoleFilter(e.target.value)}\r\n          className=\"px-3 py-2 rounded-2xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n        />\r\n        <button\r\n          onClick={() => {\r\n            setUsernameFilter(\"\");\r\n            setEmailFilter(\"\");\r\n            setRoleFilter(\"\");\r\n          }}\r\n          className=\"px-4 py-2 rounded-2xl bg-gray-200 hover:bg-gray-300 font-semibold\"\r\n        >\r\n          Clear\r\n        </button>\r\n      </div>\r\n\r\n      {/* Data Table - Neumorphic container */}\r\n      <div className=\"bg-white rounded-2xl shadow-md p-2 overflow-x-auto w-full max-w-7xl px-4\">\r\n        <DataTable\r\n          columns={columns}\r\n          data={filteredUsers}\r\n          pagination\r\n          striped\r\n          highlightOnHover\r\n          dense\r\n        />\r\n      </div>\r\n\r\n      {/* DELETE MODAL - Neumorphic styled */}\r\n      {showDeleteModal && selectedUser && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50\">\r\n          <div className=\"bg-[#e6e9ef] p-6 rounded-2xl w-full max-w-sm shadow-[8px_8px_16px_rgba(0,0,0,0.18),-6px_-6px_#ffffff] text-center\">\r\n            <h2 className=\"text-lg font-semibold mb-3\">Confirm Delete</h2>\r\n            <p className=\"mb-4\">\r\n              Are you sure you want to delete user{\" \"}\r\n              <b>{selectedUser.username}</b>?\r\n            </p>\r\n            <div className=\"flex justify-center gap-4\">\r\n              <button\r\n                onClick={() => setShowDeleteModal(false)}\r\n                className=\"bg-gray-300 px-4 py-2 rounded-2xl font-semibold\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleDeleteUser}\r\n                className=\"bg-red-600 text-white px-4 py-2 rounded-2xl hover:bg-red-700 font-semibold\"\r\n              >\r\n                Delete\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UsersPage;"],"names":[],"mappings":"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","debugId":null}}]
}